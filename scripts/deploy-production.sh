#!/bin/bash
# scripts/deploy-production.sh

echo "üöÄ –†–ê–ó–í–ï–†–¢–´–í–ê–ù–ò–ï –í –ü–†–û–î–ê–ö–®–ù..."

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ production .env
if [ ! -f ".env.production" ]; then
    echo "‚ùå –§–∞–π–ª .env.production –Ω–µ –Ω–∞–π–¥–µ–Ω!"
    echo "üí° –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª .env.production —Å production –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏"
    exit 1
fi

# –ó–∞–≥—Ä—É–∂–∞–µ–º production –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
export $(cat .env.production | xargs)

# –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
echo "üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤..."
docker-compose down

# –°–æ–±–∏—Ä–∞–µ–º –æ–±—Ä–∞–∑—ã
echo "üî® –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–æ–≤..."
docker-compose -f docker-compose.production.yml build --no-cache

# –ó–∞–ø—É—Å–∫–∞–µ–º –≤ –ø—Ä–æ–¥–∞–∫—à–Ω —Ä–µ–∂–∏–º–µ
echo "‚ñ∂Ô∏è –ó–∞–ø—É—Å–∫ –≤ –ø—Ä–æ–¥–∞–∫—à–Ω —Ä–µ–∂–∏–º–µ..."
docker-compose -f docker-compose.production.yml up -d

# –ñ–¥–µ–º –∑–∞–ø—É—Å–∫–∞
echo "‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞..."
sleep 30

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å
echo "üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞..."
docker-compose -f docker-compose.production.yml ps

echo "‚úÖ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!"
echo "üåê –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ –Ω–∞: http://0.0.0.0:8000"
echo "üë§ –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å: http://0.0.0.0:8000/admin"